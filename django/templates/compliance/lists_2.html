{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Begin Page Content -->
<style>
    .ex-text {
        padding: 0.4rem 0.8rem;
        font-size : 15px;
        background-color: #444444;
        border-radius: 0.3rem;
        color: #ffffff;
        position: absolute;
        opacity: 0;
        transition: all ease 0.5s;
    }
    .ex:hover + .ex-text {
        opacity: 1;
    }

    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 30px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .close-button {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
    }
</style>
<h2> {{no}} {{name}}
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="font-size:15px;">
                <thead>
                <tr>
                    <th class="text-center">항목</th>
                    <th>{{no}} {{name}}</th>
                </tr>
                </thead>
                <tbody>
                    {% for a in article_list %}
                    <tr>
                        <td style="text-align:center">인증 기준</td>
                        <td>{{a.articleComment}}</td>
                    </tr>
                    <tr>
                        <td style="text-align:center" width="200px" rowspan=len({{checklist}})>주요 확인사항</td>
                        <td>{% for i in a.articleChecklist %}{{i|linebreaks}}{% endfor %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
<h4 class="m-0 font-weight-bold text-teiren"> Related Law </h4>
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="text-align:center; font-size:15px;">
                <thead>
                    <tr>
                        <th>Law</th>
                        <th>Chapter</th>
                        <th>Section</th>
                        <th>Article</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in law %}
                        {% if i.lawName == '' and i.chapterNo == '' and i.sectionNo == '' and i.articleNo == '' %}
                        <tr>
                            <td colspan="4">엣큥!! 관련 법령이 없어요</td>
                        </tr>
                        {% else %}
                    <tr>
                        <td>{{i.lawName}}</td>
                        <td>{{i.chapterNo}} {{i.chapterName}}</td>
                        <td>{{i.sectionNo}} {{i.sectionName}}</td>
                        <td>{{i.articleNo}} {{i.articleName}}</td>
                    </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
<h4 class="m-0 font-weight-bold text-teiren"> Evidence List
    <button class="ex btn btn-md" style="font-size:0.7vw">ex</button>
    <div class="ex-text">{% for a in article_list %}{% for i in a.articleExample %}{{i|linebreaks}}{% endfor %}{% endfor %}</div>
        <button type="button" class="btn btn-md btn-teiren" onclick="openModal()">add</button>
    </h4>
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="text-align:center; font-size:15px;">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Data Comment</th>
                        <th>File</th>
                        <th>File Comment</th>
                        <th>Version</th>
                        <th>담당자</th>
                        <td>Upload Date</td>
                        <td>Upload</td>
                        <th>Preview</th>
                        <th>Download</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <!--for 문으로 리스트 출력: 파이썬 코드를 쓸 때는 % % 안에 담아서 사용-->
                    {% for a in evidence_list %}
                    <tr>
                        <td>{{a.dataName}}</td>
                        <td>{{a.dataComment}}</td>
                        <td>{{a.fileName}}</td>
                        <td>{{a.fileComment}}</td>
                        <td>{{a.fileVersion}}</td>
                        <td>{{a.filePoc}}</td>
                        <td>{{a.fileUploadDate}}</td>
                        <td>{{a.fileAuthor}}</td>
                        <td>
                            <button class="btn btn-md btn-teiren">
                                preview
                            </button>
                        </td>
                        <td>
                            <button class="btn btn-md btn-teiren">
                                download
                            </button>
                        </td>
                        <td>
                            <form method="post">
                                <input type="hidden" name="file_name" id="file_name" value="{{a.fileName}}"/>
                                <button type="button" class="btn btn-md btn-teiren" onclick="deleteEvidence(this)">delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div>
        <form id="evidence_form" enctype="multipart/form-data">
            <label for="dataName">Data:</label>
            <input type="text" id="dataName" name="dataName">

            <label for="dataComment">Comment:</label>
            <input type="text" id="dataComment" name="dataComment" placeholder="Enter a Comment">
            
            <label for="fileComment">File Comment:</label>
            <input type="text" id="fileComment" name="fileComment" placeholder="Enter a Comment">
            
            <label for="version">Version:</label>
            <input type="text" id="version" name="version" placeholder="ex. v_1.0">

            <label for="author">Author:</label>
            <input type="text" id="author" name="author">
            
            <label for="poc">Poc:</label>
            <input type="text" id="poc" name="poc">

            <input type="file" name="uploadedFile">
            {% csrf_token %}
            <input type="hidden" name="art_no" id="art_no" value="{{no}}"/>
            <input type="submit" value="Upload">
        </form>
    </div>


<script>
    function deleteEvidence(e){
        var data=$(e).parent().serialize()
        $.ajax({
        url:'/compliance/delete/',
        headers:{
            'X-CSRFToken': '{{csrf_token}}'
        },
        data: data,
        type: 'post'
    }).done(function(response){
        alert(response)
    })   
    }

    $('#evidence_form').on('submit', function(e){
        e.preventDefault();

        var formData = new FormData(this)
        
        $.ajax({
            url: '/compliance/add/',
            headers: {
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: formData,
            type: 'post',
            processData: false,  // Important!
            contentType: false,  // Important!
            success: function(response) {
                alert(response);
            }
        });
    })

    function openModal() {
        // Display the modal overlay
        document.getElementById('modalOverlay').style.display = 'block';
    }

    function closeModal() {
        // Hide the modal overlay
        document.getElementById('modalOverlay').style.display = 'none';
    }
</script>

{% endblock %}