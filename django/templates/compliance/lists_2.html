{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Begin Page Content -->
<style>
    .ex-text {
        padding: 0.4rem 0.8rem;
        font-size : 15px;
        background-color: #444444;
        border-radius: 0.3rem;
        color: #ffffff;
        position: absolute;
        opacity: 0;
        transition: all ease 0.5s;
    }
    .ex:hover + .ex-text {
        opacity: 1;
    }
</style>
<h2> {{no}} {{name}}
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="font-size:15px;">
                <thead>
                <tr>
                    <th class="text-center">항목</th>
                    <th>{{no}} {{name}}</th>
                </tr>
                </thead>
                <tbody>
                    {% for a in article_list %}
                    <tr>
                        <td style="text-align:center">인증 기준</td>
                        <td>{{a.articleComment}}</td>
                    </tr>
                    <tr>
                        <td style="text-align:center" width="200px" rowspan=len({{checklist}})>주요 확인사항</td>
                        <td>{% for i in a.articleChecklist %}{{i|linebreaks}}{% endfor %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
<h4 class="m-0 font-weight-bold text-teiren"> Related Law </h4>
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="text-align:center; font-size:15px;">
                <thead>
                    <tr>
                        <th>Law</th>
                        <th>Chapter</th>
                        <th>Section</th>
                        <th>Article</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in law %}
                        {% if i.lawName == '' and i.chapterNo == '' and i.sectionNo == '' and i.articleNo == '' %}
                        <tr>
                            <td colspan="4">엣큥!! 관련 법령이 없어요</td>
                        </tr>
                        {% else %}
                    <tr>
                        <td>{{i.lawName}}</td>
                        <td>{{i.chapterNo}} {{i.chapterName}}</td>
                        <td>{{i.sectionNo}} {{i.sectionName}}</td>
                        <td>{{i.articleNo}} {{i.articleName}}</td>
                    </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
<h4 class="m-0 font-weight-bold text-teiren"> Evidence List
    <button class="ex btn btn-md" style="font-size:0.7vw">ex</button>
    <div class="ex-text">{% for a in article_list %}{% for i in a.articleExample %}{{i|linebreaks}}{% endfor %}{% endfor %}</div>
    <button class="btn btn-md btn-teiren" data-toggle="modal" data-target="#upload_file">add</button>
    </h4>
    <!-- Modal -->
    <div class="modal hide fade card-body" id="upload_file" role="dialog" aria-labelledby="detailLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style='width:700px; height:auto'>
                <div class="modal-header">
                    <h5 class="m-0 font-weight-bold text-primary" id='modal_title'>Upload Evidence File</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">x</span>
                    </button>
                </div>
                <div class="modal-body card-body" style="font-size:12px;">
                    <form id="evidence_form" enctype="multipart/form-data">
                    <div>
                        <p>Data: <input type="text" class="form-control" id='dataName' name="dataName" value=''></p>
                        <p>Data Comment: <input type="text" class="form-control" id='dataComment' name="dataComment" value='' placeholder="Enter a Comment of Data"></p>
                        <p>File Comment: <input type="text" class="form-control" id='fileComment' name="fileComment" value='' placeholder="Enter a Comment of File"></p>
                        <p>Version: <input type="text" class="form-control" id='version' name="version" value='' placeholder="ex. v_1.0"></p>
                        <p>Author: <input type="text" class="form-control" id='author' name="author" value=''></p>
                        <p>Poc: <input type="text" class="form-control" id='poc' name="poc" value=''></p>
                        <input type="file" name="uploadedFile">
                        {% csrf_token %}
                    </div>
                </div>
                <div class="modal-footer" id="modal_footer">
                    <input type="hidden" name="art_no" id="art_no" value="{{no}}"/>
                    <input type='submit' id='add' class="btn btn-md btn-outline-primary" value="Upload">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body" style="font-size:15px;">
        <div class="table-responsive" style="overflow:hidden;">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
                   style="text-align:center; font-size:15px;">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Data Comment</th>
                        <th>File</th>
                        <th>File Comment</th>
                        <th>Version</th>
                        <th>PoC</th>
                        <th>Upload Date</th>
                        <th>Upload</th>
                        <th>Preview</th>
                        <th>Download</th>
                        <th>Modify</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in evidence_list %}
                    <tr>
                        <td>{{a.dataName}}</td>
                        <td>{{a.dataComment}}</td>
                        <td>{{a.fileName}}</td>
                        <td>{{a.fileComment}}</td>
                        <td>{{a.fileVersion}}</td>
                        <td>{{a.filePoc}}</td>
                        <td>{{a.fileUploadDate}}</td>
                        <td>{{a.fileAuthor}}</td>
                        <td>
                            <button class="btn btn-md btn-teiren">
                                preview
                            </button>
                        </td>
                        <td>
                            <button class="btn btn-md btn-teiren">
                                download
                            </button>
                        </td>
                        <td>
                            <form method="post">
                                <input type="hidden" name="file_name" id="file_name" value="{{a.fileName}}"/>
                                <button type="button" class="btn btn-md btn-teiren" data-toggle="modal" data-target="#modify_file">modify</button>
                            </form>
                        </td>
                        <td>
                            <form method="post">
                                <input type="hidden" name="file_name" id="file_name" value="{{a.fileName}}"/>
                                <button type="button" class="btn btn-md btn-teiren" onclick="deleteEvidence(this)">delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

<script>
    function deleteEvidence(e){
        var data=$(e).parent().serialize()
        $.ajax({
        url:'/compliance/delete/',
        headers:{
            'X-CSRFToken': '{{csrf_token}}'
        },
        data: data,
        type: 'post'
    }).done(function(response){
        alert(response)
    })   
    }

    $('#evidence_form').on('submit', function(e){
        e.preventDefault();

        var formData = new FormData(this)
        
        $.ajax({
            url: '/compliance/add/',
            headers: {
                'X-CSRFToken': '{{csrf_token}}'
            },
            data: formData,
            type: 'post',
            processData: false,  // Important!
            contentType: false,  // Important!
            success: function(response) {
                alert(response);
            }
        });
    })

</script>

{% endblock %}