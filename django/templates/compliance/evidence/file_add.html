{% extends 'base.html' %}
{% load static %}

{% block content %}

  <!-- Begin Page Content -->


  <h3>
    {% for d in data %}
      Data Name: 
      {{d.data.name}}<br><br>

      Data Comment:
      {{d.data.comment}}<br><br>
       
    <form id="add_file">
      <input name="data_name" value="{{d.data.name}}" type="hidden"/>

      File name:
      <input name="file_name" type="text"><br><br>

      File comment:
      <input name="comment" type="text"><br><br>

      Version:
      <input name="version" type="text"><br><br>

      Author:
      <input name="author" type="text"><br><br>

      POC:
      <input name="poc" type="text"><br><br>

      Upload file:
      <h5>image 파일 전체, pdf, 엑셀(xlsx, xls, csv), 한글파일(hwp, hwpx), 파워포인트(ppt, pptx), 워드(docx, doc) 형식만 업로드 가능합니다.</h5>
      <input name="file" type="file" accept="image/*, .pdf, .xlsx, .xls, .hwp, .hwpx, .ppt, .pptx, .csv, .docx, .doc"><br><br>

  </form>
  <button class="btn btn-md btn-teiren" onclick="add_file('{data_name}')">제출</button>
  {% endfor %}

</form>

<script>
  function add_file(data_name){
    var data=$('#add_file').serialize()
      $.ajax({
          url: '/compliance/evidence/file_add_func/',
          headers: {
              'X-CSRFToken': "{{ csrf_token }}"
          },
          type: 'POST',
          data: data,
          success: function(response){
              if(response.startsWith('\n<meta')){
                  location.reload() //이전 목록 페이지로 가야 되는데 어떻게 하는지 모르겠음
              }
              if(response === 'success'){
                  alert('Saved Successfully')
                  //location.reload()
              }else if(response === 'already exist'){
                alert('file name is already exist. Try Again') //중복된거면 카테고리 comment라도 수정할 건지 물어볼 수 있어야 되는데,,,
              }else if(response === 'NULL'){
                  alert('Data name must be entered. Try Again')
              }
              else {
                  alert('Failed To Save. Please Try Again')
              }
          },
          error : function(xhr,errmsg,err) {
              console.log(xhr.status + ": " + xhr.responseText); 
          }
      })
  }
</script>
{% endblock %}

