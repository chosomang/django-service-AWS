{% extends 'base.html' %}
{% load custom_filter %}
{% load static %}

{% block content %}
<!-- Begin Page Content -->
<h1>ISMS-P</h1>

<br>
<!--단일 변수 출력-->
<h2>{{test_string}}</h2>
<br>

<div class="d-flex text-center mb-2">
        <br>
        <label for="com_version">Choose Version:</label>
        <select id="com_version" name="com_version" class="btn btn-md" style="background-color:#FFFFFF; border-color:#E5E5E5; width:100%;">
            {% for a in version_list %}
            <option value="{{a}}">{{a}}</option>
            {% endfor %}
        </select>
        <br>
        <label for="com_product">Choose Product:</label>
        <select id="com_product" name="com_product" class="btn btn-md" style="background-color:#FFFFFF; border-color:#E5E5E5; width:100%;">
            {% for a in product_list %}
            <option value="{{a.productName}}">{{a.productName}}</option>
            {% endfor %}
        </select>
    <div>
        <button class="btn btn-md btn-teiren" onclick="versionModify()">
            Select
        </button>
    </div>
</div>

<div id="com_table" class="card-body" style="font-size:15px;">
    <div class="table-responsive" style="overflow:hidden;">
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0"
               style="text-align:center;font-size:15px;">
            <thead>
            <tr>
                <th>Chapter</th>
                <th>Section</th>
                <th>Article</th>
                <th>Comment</th>
                <th>준수 여부</th>
                <th>사내 정책</th>
                <th>Last Update</th>
                <th>Details</th>
            </tr>
            </thead>
            <tfoot>
            <tr>
                <th>Chapter</th>
                <th>Section</th>
                <th>Article</th>
                <th>Comment</th>
                <th>준수 여부</th>
                <th>사내 정책</th>
                <th>Last Update</th>
                <th>Details</th>
            </tr>
            </tfoot>

            <tbody>
                <!--for 문으로 리스트 출력: 파이썬 코드를 쓸 때는 % % 안에 담아서 사용-->
                {% for com in compliance %}
                <tr>
                    <td>{{com.chapterNo}}. {{com.chapterName}}</td>
                    <td>{{com.sectionNo}} {{com.sectionName}}</td>
                    <td>{{com.articleNo}}. {{com.articleName}}</td>
                    <td width="40%">{{com.articleComment}}</td>
                    <td style="width:4%">
                        <select name="com_score" class="com_score btn btn-md" style="background-color:#FFFFFF; border-color:#E5E5E5; width:100%;">
                            <option value="{{com.complyScore}}" selected>{{com.complyScore}}</option>
                            {% make_list 0 1 2 as score %}
                            {% for option_value in score %}
                                {% if option_value != com.complyScore %}
                                    <option value="{{option_value}}" >{{option_value}}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <input type="hidden" class="com_article" value="{{com.articleNo}}">
                    </td>
                    <td>사내 정책</td>
                    <td>date</td>
                    <td>
                        <form  method="POST" action="/compliance/lists_2/">
                            {% csrf_token %}
                            <input type="hidden" name="no" value="{{com.articleNo}}"/>
                            <input type="hidden" name="name" value="{{com.articleName}}"/>
                            <button class="btn btn-md btn-teiren" style="font-size:0.7vw">
                                Details
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function versionModify(){
        var version = $('#com_version').val()
        var product = $('#com_product').val()
        $('#com_table').fadeOut('normal')
        $.ajax({
            url:'/compliance/version_modify/',
            headers:{
                'X-CSRFToken': '{{csrf_token}}'
            },
            data:{
                version: version,
                product: product
            },
            type: 'post'
        }).done(function(response){
            console.log(response)
            $('#com_table').html(response)
            $('#com_table').fadeIn('fast')
        })
        
    }

    $('.com_score').on('change', function(){
        var value = this.value
        var article = $(this.parentNode).find('.com_article').val()
        var product = $('#com_product').val()
        var version = $('#com_version').val()
        console.log(article, product, version)
    
    $.ajax({
    url:'/compliance/version_modify/',
    headers:{
        'X-CSRFToken': '{{csrf_token}}'
    },
    data:{
        version: version,
        product: product,
        article : article,
        value :value
    },
    type: 'post'
    }).done(function(response){
        console.log(response)
    })

    })

</script>

{% endblock %}


